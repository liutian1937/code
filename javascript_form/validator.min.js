(function(){var p={together:false,errShow:'alert',errBox:false,timely:false}var g={extend:function(a,c){var b,d={};for(b in a){d[b]=c[b]?c[b]:a[b]}return d},each:function(a,c){var b;if(a.constructor===Array){for(var d=0;d<a.length;d+=1){b=c(d,a[d]);if(b=='break'){return false}}}else if(typeof a==='object'){for(var d in a){b=c(d,a[d]);if(b=='break'){return false}}}},inArray:function(a,c){var b=0,d=c.length,e=false,f={};for(;b<d;b+=1){f[c[b]]=true}return f[a]},hasClass:function(a,c){var b=new RegExp('(\\s|^)'+c+'(\\s|$)');return a.className.match(b)},insertAfter:function(a,c){var b=c.parentNode;if(b.lastChild==c){c.appendChild(a)}else{b.insertBefore(a,c.nextSibling)}},getErrBox:function(a,c,b){var d=a.parentNode.getElementsByTagName(c),e=0,f=d.length,j;if(f>0){for(;e<f;e+=1){if(g.hasClass(d[e],b)){j=d[e];return false}}}if(j){return j}else{var l=document.createElement(c);l.className=b;g.insertAfter(l,a);return l}},addMsg:function(a,c){a.style.display='inline-block';a.innerHTML=c},bind:(function(){if(window.addEventListener){return function(a,c,b,d){a.bindFn={};a.addEventListener(c,function(){b();a.bindFn[c]=a.bindFn[c]||[];a.bindFn[c].push(arguments.callee)},d)}}else if(window.attachEvent){return function(a,c,b,d){a.bindFn={};a.attachEvent("on"+c,function(){b();a.bindFn[c]=a.bindFn[c]||[];a.bindFn[c].push(arguments.callee)})}}})(),unbind:(function(){if(window.addEventListener){return function(a,c){if(a.bindFn&&a.bindFn[c]){var b=0,d=a.bindFn[c].length;for(b;b<d;b+=1){a.removeEventListener(c,a.bindFn[c][b])}}else{a.removeEventListener(c)}}}else if(window.attachEvent){return function(a,c){if(a.bindFn&&a.bindFn[c]){var b=0,d=a.bindFn[c].length;for(b;b<d;b+=1){a.detachEvent("on"+c,a.bindFn[c][b])}}else{a.detachEvent("on"+c)}}}})(),isEmpty:function(a){a=a.replace(/(^\s*)|(\s*$)/g,"");return(a.length)==0?true:false}}var h=function(a,c){if(!(this instanceof h)){return new h(a,c)}this.options=g.extend(p,c);this.formobj=document.forms[a];if(!this.formobj){alert("找不到表单"+a);return}this.init()}h.prototype.init=function(){var a=this,c=this.formobj;c.oldSubmit=null;if(c.onsubmit){c.oldSubmit=c.onsubmit;c.onsubmit=null}c.onsubmit=function(){if(a.checkForm()){a.showError();return false}else{return c.oldSubmit()}}a.ruleData=[];a.errObjList={};a.errorHash={};a.errorArray=[];a.errorFnArray=[]}h.prototype.addValidation=function(){var f=this,j,l,i,m,k,n={};if(arguments[0].constructor===Array){g.each(arguments[0],function(d,e){m=e[0];k=f.formobj[m];if(!k){return'break'}j=e[1].search('=');if(j>=0){l=e[1].substring(0,j);i=e[1].substr(j+1);if(l!='regex'){i=isNaN(i)?i:parseInt(i);if(/^('|")\w+/.test(i)){i=i.replace(/^('|")|('|")$/g,'').split('|')}}}else{l=e[1];i=undefined}n={name:m,obj:k,rule:l,ruleExt:i!==false?i:'',msg:e[2]||''}f.ruleData.push(n);if(f.options.timely){(function(b){if(k.length>0){k.tagName=='SELECT'?(function(){g.bind(k,'change',function(){f.checkSingle(b,true);f.checkError(b)})})():(function(){for(var c=0;c<k.length;c+=1){(function(a){g.bind(k[a],'click',function(){f.checkSingle(b,true);f.checkError(b)})})(c)}})()}else{g.bind(k,'blur',function(){f.checkSingle(b,true);f.checkError(b)})}})(n)}})}}h.prototype.checkForm=function(){var b=this;b.errorHash={};b.errorArray=[];b.hideError();g.each(b.ruleData,function(a,c){if(b.options.together){b.checkSingle(c)}else{if(b.errorArray.length<1){b.checkSingle(c)}else{return'break'}}});return b.errorArray.length>0?true:false}h.prototype.checkSingle=function(b,d){var e=this;if(o[b.rule]){if(!o[b.rule].call(e,b)){if(!e.errorHash[b.name]){var f=e.errorArray.push(b);e.errorHash[b.name]=f}}else{var j=false,f=e.errorHash[b.name];if(d&&f>0){g.each(e.errorArray,function(a,c){if(c['name']==b.name){if(e.errorArray[a]['rule']==b.rule){e.errorArray.splice(a,1);e.errorHash[b.name]=false;return false}}})}}}else{e.errorHash['V_params']=true;e.errorArray.push({msg:'参数定义错误'})}}h.prototype.showError=function(){var b=this,d=[],e;if(typeof b.options.errShow=='function'){b.options.errShow(b.errorArray)}else{switch(b.options.errShow){case'alert':case'multiple':g.each(b.errorArray,function(a,c){if(typeof c.msg=='string'){d.push(c.msg)}else if(typeof c.msg=='function'){c.msg()}});if(b.options.errShow=='alert'){alert(d.join('\n'))}else{b.showErrorBox(b.formobj,d.join('<br/>'))}break;case'single':g.each(b.errorArray,function(a,c){if(typeof c.msg=='string'){b.showErrorSingle(c)}else if(typeof c.msg=='function'){c.msg()}});break}}}h.prototype.showErrorSingle=function(a){var c=this,b=a.obj,d=a.msg,e=a.name;if(!c.errObjList[e]){if(b.tagName!='SELECT'&&b.length){b=b[b.length-1]}c.errObjList[e]=g.getErrBox(b,'span','error_strings')}if(typeof d=='string'){g.addMsg(c.errObjList[e],d)}else if(typeof d=='function'){d()}}h.prototype.showErrorBox=function(a,c){var b=this,d=a.parentNode.getElementsByTagName('div');if(b.errGlobalObj){b.errGlobalObj.innerHTML=c}else{for(var e=0;e<d.length;e+=1){if(g.hasClass(d[e],'error_strings')){b.errGlobalObj=d[e];g.addMsg(b.errGlobalObj,c);return false}}if(!b.errGlobalObj){b.errGlobalObj=document.createElement('div');b.errGlobalObj.className='error_strings';b.errGlobalObj.innerHTML=c;g.insertAfter(b.errGlobalObj,a)}}}h.prototype.checkError=function(b){var d=this,e=d.errorHash[b.name];if(e>0){g.each(d.errorArray,function(a,c){if(c['name']==b.name){if(d.errorArray[a]['rule']==b.rule){d.showErrorSingle(d.errorArray[a]);return false}}})}else{d.hideError(b.name)}}h.prototype.hideError=function(b){var d=this;if(b){if(d.errObjList[b]){d.errObjList[b].style.display='none'}return false}if(d.errGlobalObj){d.errGlobalObj.style.display='none'}if(d.errObjList){g.each(d.errObjList,function(a,c){c.style.display='none'})}}var o={'regex':function(a){return eval(a.ruleExt).test(a.obj.value)},'required':function(a){return g.isEmpty(a.obj.value)?false:true},'maxlength':function(a){return g.isEmpty(a.obj.value)?true:a.obj.value.length<a.ruleExt},'minlength':function(a){return g.isEmpty(a.obj.value)?true:a.obj.value.length>a.ruleExt},'number':function(a){return g.isEmpty(a.obj.value)?true:/^[\d]+$/.test(a.obj.value)},'alpha':function(a){return g.isEmpty(a.obj.value)?true:/^[A-Za-z]+$/.test(a.obj.value)},'string':function(a){return g.isEmpty(a.obj.value)?true:/^\\w+$/.test(a.obj.value)},'email':function(a){return g.isEmpty(a.obj.value)?true:/\w+((-w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z0-9]+/.test(a.obj.value)},'telphone':function(a){return g.isEmpty(a.obj.value)?true:/^[+]{0,1}(\d){1,3}[ ]?([-]?((\d)|[ ]){1,12})+$/.test(a.obj.value)},'mobile':function(a){return g.isEmpty(a.obj.value)?true:/^0?1(3|5|8)\d{9}$/.test(a.obj.value)},'lessthan':function(a){var c=typeof a.ruleExt=='number'?a.ruleExt:parseInt(this.formobj[a.ruleExt].value);return parseInt(a.obj.value)<c},'greaterthan':function(a){var c=typeof a.ruleExt=='number'?a.ruleExt:parseInt(this.formobj[a.ruleExt].value);return parseInt(a.obj.value)>c},'equal':function(b){var d=b.obj.value,e=b.ruleExt,f=this;return typeof e=='number'?(function(){return parseInt(d)==e})():(function(){if(e.constructor===Array){var a=true;for(var c=0;c<e.length;c+=1){if(d==e[c]){a=false;return false}}return a}else{return d==f.formobj[e].value}})()},'unequal':function(b){var d=b.obj.value,e=b.ruleExt,f=this;return typeof e=='number'?(function(){return parseInt(d)!=e})():(function(){if(e.constructor===Array){var a=true;for(var c=0;c<e.length;c+=1){if(d==e[c]){a=false;return false}}return a}else{return d!=f.formobj[e].value}})()},'notselect':function(d){return d.obj.tagName=='SELECT'?(function(){var a=d.obj.selectedIndex;return d.obj.options[a].value!=d.ruleExt})():(function(){var a=d.obj,c=true;if(a.length){if(d.ruleExt&&d.ruleExt.constructor===Array){checklen=d.ruleExt.length;for(var b=0;b<a.length;b+=1){if(a[b].checked==true&&g.inArray(a[b].value,d.ruleExt)){c=false;return false}}}else{for(var b=0;b<a.length;b+=1){if(a[b].checked==true){if(d.ruleExt===undefined){c=false;return false}else if(a[b].value==d.ruleExt){c=false;return false}}}}}else{if(a.checked==true){c=false}}return c})()},'shouldselect':function(a){var c=a.obj,b=false,d=0,e=0;if(c.length){if(a.ruleExt&&a.ruleExt.constructor===Array){d=a.ruleExt.length;for(var f=0;f<c.length;f+=1){if(c[f].checked==true&&g.inArray(c[f].value,a.ruleExt)){e+=1}}b=(d===e)?true:false}else{for(var f=0;f<c.length;f+=1){if(c[f].checked==true){if(a.ruleExt===undefined){b=true}else if(c[f].value==a.ruleExt){b=true}}}}}else{if(c.checked==true){b=true}}return b},'minselect':function(a){var c=a.obj,b=0;if(c.length){for(var d=0;d<c.length;d+=1){if(c[d].checked==true){b+=1}}}else{if(c.checked==true){b+=1}}return b>=a.ruleExt},'maxselect':function(a){var c=a.obj,b=0;if(c.length){for(var d=0;d<c.length;d+=1){if(c[d].checked==true){b+=1}}}else{if(c.checked==true){b+=1}}return b<=a.ruleExt}}window.Validator=h})();